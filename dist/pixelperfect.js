(function(){var e=function(e,t,n){var r,i,s,o;if(e.nodeName)return this.elements=[e],this.elements_length=1,this;typeof t=="boolean"&&(n=t,t=undefined),n===undefined&&(n=!0);if(n&&this.elements===null){r=[],t===undefined&&(t=document),i=t.querySelectorAll(e),s=i.length;for(o=0;o<s;o++)r.push(i[o]);this.elements=r,this.elements_length=r.length}return this};e.prototype={elements:null,elements_length:0,event:function(t,n){var r;return this.elements.every(function(r){return r.addEventListener(t,n.bind(new e(r))),!0}),this},remove:function(){return this.elements.every(function(e){return e.parentNode.removeChild(e),!0}),this},removeClass:function(e){return this.elements.every(function(t){return t.className=t.className.replace(RegExp(e,"g"),"").replace(/^\s+|\s+$/,""),!0}.bind(this)),this},addClass:function(e){return this.removeClass(e),this.elements.every(function(t){return t.className+=" "+e,!0}.bind(this)),this},setOpacity:function(e){return this.elements.every(function(t){return t.style.opacity=(parseInt(e,10)/100).toString(),!0}.bind(this)),this}},DragAndDrop={makeDraggable:function(e,t){var n;for(n=0;n<e.elements_length;n++)t===undefined?t=e.elements[n]:(t=e.elements[n].querySelector(t),t||(t=e.elements[n])),t.addEventListener("mousedown",function(e){document.currentDragged=this,document.currentDragged.mouseDiffX=e.pageX-this.offsetLeft,document.currentDragged.mouseDiffY=e.pageY-this.offsetTop}.bind(e.elements[n]))},init:function(){var e,t,n;document.addEventListener("mouseup",function(){this.currentDragged&&localStorage.setItem("pixelperfect:draganddrop:"+this.currentDragged.getAttribute("id"),parseInt(this.currentDragged.style.left,10).toString()+","+parseInt(this.currentDragged.style.top,10).toString()),this.currentDragged=!1}),document.addEventListener("mousemove",function(e){this.currentDragged&&(this.currentDragged.style.right="auto",this.currentDragged.style.bottom="auto",this.currentDragged.style.left=(e.pageX-this.currentDragged.mouseDiffX).toString()+"px",this.currentDragged.style.top=(e.pageY-this.currentDragged.mouseDiffY).toString()+"px")});for(e in localStorage)e.match(/pixelperfect:draganddrop/)&&localStorage.hasOwnProperty(e)&&(t=document.getElementById(e.replace("pixelperfect:draganddrop:","")),n=localStorage.getItem(e).split(","),t.style.left=n[0]+"px",t.style.top=n[1]+"px")}};var t={insertLayer:function(e,t){var n=document.createElement("div"),r=document.createElement("a"),i=new Image,s=document.createElement("canvas"),o=s.getContext("2d");n.className="pixelperfect-layer",r.className="pixelperfect-button",r.innerHTML="&#10008;",n.appendChild(i),n.appendChild(r),e.match(/^blob:/)?i.onload=function(){var e,t;e=i.src.replace("blob:",""),t="pixelperfect:layer:"+e,s.width=i.width,s.height=i.height,o.drawImage(i,0,0),localStorage.setItem(t,s.toDataURL("image/jpeg")),n.setAttribute("data-id",t),URL.revokeObjectURL(e),this.appendLayer(n),this.selectLayer(this.fillSelected())}.bind(this):(t!==undefined&&n.setAttribute("data-id",t),this.appendLayer(n),this.selectLayer(this.fillSelected())),i.src=e},appendLayer:function(e){$("#pixelperfect-layers").elements[0].appendChild(e)},selectLayer:function(e){var t,r=localStorage.getItem("pixelperfect:selected");if(e==r)return;e===undefined&&(e=this.fillSelected()),e&&($("#pixelperfect-layers .pixelperfect-layer").removeClass("pixelperfect-layer-selected"),$('#pixelperfect-layers .pixelperfect-layer[data-id="'+e+'"]').addClass("pixelperfect-layer-selected"),localStorage.setItem("pixelperfect:selected",e),n.refreshOverlay(e))},removeLayer:function(e){$('#pixelperfect-layers .pixelperfect-layer[data-id="'+e+'"]').remove(),localStorage.removeItem(e),this.selectLayer(this.fillSelected())},fillSelected:function(){var e,t=localStorage.getItem("pixelperfect:selected");if(!t||!localStorage.getItem(t))for(e in localStorage)if(e.match(/^pixelperfect:layer/)&&localStorage.hasOwnProperty(e)){t=e;break}return t},refresh:function(){var e;$("#pixelperfect-layers .pixelperfect-layer").remove();for(e in localStorage)e.match(/^pixelperfect:layer/)&&localStorage.hasOwnProperty(e)&&this.insertLayer(localStorage.getItem(e),e);this.selectLayer()},init:function(){this.refresh(),$("#pixelperfect-layers").event("click",function(e){var n;e.preventDefault(),e.target.className.match("pixelperfect-button")?t.removeLayer.call(t,e.target.parentNode.getAttribute("data-id")):((n=e.target.getAttribute("data-id"))||(n=e.target.parentNode.getAttribute("data-id")))&&t.selectLayer(n)})}},n={STYLES:"I3BpeGVscGVyZmVjdHt3aWR0aDoyMDBweDtwYWRkaW5nOjEwcHg7cG9zaXRpb246Zml4ZWQ7cmlnaHQ6MjBweDt0b3A6MjBweDtjdXJzb3I6ZGVmYXVsdDstbW96LWJvcmRlci1yYWRpdXM6OHB4Oy13ZWJraXQtYm9yZGVyLXJhZGl1czo4cHg7LW8tYm9yZGVyLXJhZGl1czo4cHg7LW1zLWJvcmRlci1yYWRpdXM6OHB4O2JvcmRlci1yYWRpdXM6OHB4Oy1tb3otYm94LXNoYWRvdzowIDAgN3B4IHJnYmEoMCwwLDAsMC42KTstd2Via2l0LWJveC1zaGFkb3c6MCAwIDdweCByZ2JhKDAsMCwwLDAuNik7LW8tYm94LXNoYWRvdzowIDAgN3B4IHJnYmEoMCwwLDAsMC42KTstbXMtYm94LXNoYWRvdzowIDAgN3B4IHJnYmEoMCwwLDAsMC42KTtib3gtc2hhZG93OjAgMCA3cHggcmdiYSgwLDAsMCwwLjYpO3otaW5kZXg6MjE0NzQ4MzY0NztiYWNrZ3JvdW5kOiNmZmZ9I3BpeGVscGVyZmVjdCAqe2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxMnB4O3RleHQtZGVjb3JhdGlvbjpub25lfSNwaXhlbHBlcmZlY3Q+ZGl2e292ZXJmbG93OmhpZGRlbjtoZWlnaHQ6MjBweDtsaW5lLWhlaWdodDoyMHB4O3BhZGRpbmc6NXB4IDB9I3BpeGVscGVyZmVjdCAucGl4ZWxwZXJmZWN0LWxhYmVse3dpZHRoOjU1cHg7cGFkZGluZy1yaWdodDo1cHg7dGV4dC1hbGlnbjpyaWdodDtkaXNwbGF5OmJsb2NrO2Zsb2F0OmxlZnQ7Zm9udC13ZWlnaHQ6Ym9sZH0jcGl4ZWxwZXJmZWN0IGlucHV0W3R5cGU9InRleHQiXXt3aWR0aDozNXB4O2hlaWdodDoxNHB4O3BhZGRpbmc6MnB4O2JvcmRlcjoxcHggc29saWQgI2MwYzBjMDstbW96LWJvcmRlci1yYWRpdXM6M3B4Oy13ZWJraXQtYm9yZGVyLXJhZGl1czozcHg7LW8tYm9yZGVyLXJhZGl1czozcHg7LW1zLWJvcmRlci1yYWRpdXM6M3B4O2JvcmRlci1yYWRpdXM6M3B4fSNwaXhlbHBlcmZlY3QgLnBpeGVscGVyZmVjdC1idXR0b257d2lkdGg6MjBweDtoZWlnaHQ6MjBweDtiYWNrZ3JvdW5kOiNiNmI2YjYgdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RkaEFRQVVBSVFVQUtLaW9xV2xwYWVucDZxcXFxeXNySyt2cjdHeHNiUzB0TGEydHJtNXVidTd1NzYrdnNEQXdNUER3OFhGeGNqSXlNckt5czNOemMvUHo5TFMwdi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8veXdBQUFBQUFRQVVBQUFGRWVBa1JkRGpOTXlpSk1oaEZNUWdCRUFJQURzPSkgcmVwZWF0LXggY2VudGVyIGNlbnRlcjtkaXNwbGF5OmJsb2NrO2Zsb2F0OnJpZ2h0O21hcmdpbi1sZWZ0OjRweDtjb2xvcjojZmZmO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjIwcHg7LW1vei1ib3JkZXItcmFkaXVzOjRweDstd2Via2l0LWJvcmRlci1yYWRpdXM6NHB4Oy1vLWJvcmRlci1yYWRpdXM6NHB4Oy1tcy1ib3JkZXItcmFkaXVzOjRweDtib3JkZXItcmFkaXVzOjRweDtmb250LXNpemU6MTZweDtjdXJzb3I6cG9pbnRlcn0jcGl4ZWxwZXJmZWN0IC5waXhlbHBlcmZlY3QtYnV0dG9uOmhvdmVye29wYWNpdHk6Ljh9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LXRvcHttYXJnaW46LTEwcHggLTEwcHggMDtwYWRkaW5nOjEwcHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2RhZGFkYTtsaW5lLWhlaWdodDoyMHB4O2N1cnNvcjptb3ZlfSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1sYW5nLXl7bWFyZ2luLWxlZnQ6MTBweH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtdmVydGljYWwtdG9we2xpbmUtaGVpZ2h0OjZweH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtdmVydGljYWwtYm90dG9te2xpbmUtaGVpZ2h0OjMwcHh9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LWhvcml6b250YWwtbGVmdHttYXJnaW4tbGVmdDowfSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1hZGRsYXllcntib3JkZXItdG9wOjFweCBzb2xpZCAjZGFkYWRhO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNkYWRhZGE7bWFyZ2luOjAgLTEwcHg7cGFkZGluZzo1cHggMTBweH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtYWRkbGF5ZXIgI3BpeGVscGVyZmVjdC1maWxle3dpZHRoOjExMHB4fSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1hZGRsYXllciAjcGl4ZWxwZXJmZWN0LWZpbGVpbnB1dHtkaXNwbGF5Om5vbmV9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LWxheWVyc3toZWlnaHQ6YXV0b30jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtbGF5ZXJzIC5waXhlbHBlcmZlY3QtbGF5ZXJ7bWF4LWhlaWdodDoxMjBweDtwYWRkaW5nOjVweCAzMHB4IDVweCA1cHg7LW1vei1ib3JkZXItcmFkaXVzOjEwcHg7LXdlYmtpdC1ib3JkZXItcmFkaXVzOjEwcHg7LW8tYm9yZGVyLXJhZGl1czoxMHB4Oy1tcy1ib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyLXJhZGl1czoxMHB4O292ZXJmbG93OmF1dG87cG9zaXRpb246cmVsYXRpdmU7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZDojZmZmO21hcmdpbi1ib3R0b206NXB4fSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1sYXllcnMgLnBpeGVscGVyZmVjdC1sYXllciwjcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtbGF5ZXJzIC5waXhlbHBlcmZlY3QtbGF5ZXIgaW1ne21heC13aWR0aDoxNjVweDttYXgtaGVpZ2h0OjEyMHB4O3ZlcnRpY2FsLWFsaWduOnRvcH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtbGF5ZXJzIC5waXhlbHBlcmZlY3QtbGF5ZXItc2VsZWN0ZWR7YmFja2dyb3VuZDojZWRlZmY0fSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1sYXllcnMgLnBpeGVscGVyZmVjdC1idXR0b257cG9zaXRpb246YWJzb2x1dGU7dG9wOjVweDtyaWdodDo1cHh9I3BpeGVscGVyZmVjdC1vdmVybGF5e3Bvc2l0aW9uOmFic29sdXRlfQ==",HTML:'<div id="pixelperfect-top"><span id="pixelperfect-lang-product-name">PixelPerfect</span><a href="#" class="pixelperfect-button" id="pixelperfect-hide">&#10008;</a><a href="#" class="pixelperfect-button" id="pixelperfect-minify">&#10134;</a><a href="#" class="pixelperfect-button" id="pixelperfect-onoff">&#9899;</a></div><div><span id="pixelperfect-lang-overlay" class="pixelperfect-label">Overlay</span><label for="pixelperfect-overlay-over"><input type="radio" name="pixelperfect-overlay" id="pixelperfect-overlay-over" />&nbsp;<span id="pixelperfect-lang-overlay-over">Over</span></label><label for="pixelperfect-overlay-below"><input type="radio" name="pixelperfect-overlay" id="pixelperfect-overlay-below" />&nbsp;<span id="pixelperfect-lang-overlay-below">Below</span></label></div><div><label for="pixelperfect-opacity"><span id="pixelperfect-lang-opacity" class="pixelperfect-label">Opacity</span><input type="text" id="pixelperfect-opacity" /></label></div><div><span id="pixelperfect-lang-position" class="pixelperfect-label">Position</span><label for="pixelperfect-x"><span id="pixelperfect-lang-x">X</span>:&nbsp;<input type="text" id="pixelperfect-x" /></label><label for="pixelperfect-y"><span id="pixelperfect-lang-y">Y</span>:&nbsp;<input type="text" id="pixelperfect-y" /></label></div><div><span id="pixelperfect-lang-align" class="pixelperfect-label">Align</span><a href="#" class="pixelperfect-button" id="pixelperfect-vertical-bottom">&#9531;</a><a href="#" class="pixelperfect-button" id="pixelperfect-vertical-middle">&#9472;</a><a href="#" class="pixelperfect-button" id="pixelperfect-vertical-top">&#9523;</a><a href="#" class="pixelperfect-button" id="pixelperfect-horizontal-right">&#9515;</a><a href="#" class="pixelperfect-button" id="pixelperfect-horizontal-center">&#9475;</a><a href="#" class="pixelperfect-button" id="pixelperfect-horizontal-left">&#9507;</a></div><div id="pixelperfect-addlayer"><span id="pixelperfect-lang-file" class="pixelperfect-label"><label for="pixelperfect-file">File</label></span><input type="text" id="pixelperfect-file" /><input type="file" id="pixelperfect-fileinput" accept="image/*" /><a href="#" class="pixelperfect-button" id="pixelperfect-upload-file">&#8683;</a></div><div id="pixelperfect-layers"></div>',DEFAULTS:{overlay:"below",opacity:"50",position:{x:0,y:0},minimized:!1,hidden:!1},options:{overlay:!1,opacity:!1,position:!1,align:!1,minimized:!1,hidden:!1},layers:[],wrapper:null,refreshOverlay:function(e){var t;e!==undefined?($("#pixelperfect-overlay").remove(),t=new Image,t.src=localStorage.getItem(e),t.setAttribute("id","pixelperfect-overlay"),document.body.appendChild(t)):t=document.getElementById("pixelperfect-overlay"),this.options.overlay=="below"?($(this.wrapper).setOpacity(this.options.opacity),t.style.zIndex="-2147483646"):($(t).setOpacity(this.options.opacity),t.style.zIndex="2147483646"),t.style.left=this.options.position.x+"px",t.style.top=this.options.position.y+"px",this.updateOptions()},updateOptions:function(){document.getElementById("pixelperfect-overlay-"+this.options.overlay).checked=!0,document.getElementById("pixelperfect-opacity").value=this.options.opacity,document.getElementById("pixelperfect-x").value=this.options.position.x,document.getElementById("pixelperfect-y").value=this.options.position.y},setDefaults:function(){var e;for(e in this.DEFAULTS)this.DEFAULTS.hasOwnProperty(e)&&!localStorage.getItem("pixelperfect:options:"+e)&&(e=="position"?localStorage.setItem("pixelperfect:options:"+e,this.DEFAULTS[e].x+","+this.DEFAULTS[e].y):localStorage.setItem("pixelperfect:options:"+e,this.DEFAULTS[e]))},initOptions:function(){var e,t;for(e in this.options)this.options.hasOwnProperty(e)&&(e=="position"?(t=localStorage.getItem("pixelperfect:options:"+e).split(","),this.options[e]={},this.options[e].x=t[0],this.options[e].y=t[1]):this.options[e]=localStorage.getItem("pixelperfect:options:"+e))},initFileHandling:function(){$("#pixelperfect-upload-file").event("click",function(e){e.preventDefault(),document.getElementById("pixelperfect-fileinput").click()}),$("#pixelperfect-fileinput").event("change",function(e){t.insertLayer(window.URL.createObjectURL(e.target.files[0]))}.bind(this))},initWrapper:function(){var e=document.createElement("div"),t=document.defaultView.getComputedStyle(document.body),n=document.body.attributes,r=document.defaultView.getComputedStyle(e),i,s,o;for(i in n)n.hasOwnProperty(i)&&e.setAttribute(n[i].name,n[i].value);for(i in t)!i.match(/^[0-9]/)&&r[i]!=t[i]&&(s=r[i],e.style[i]=t[i],document.body.style[i]=s);e.className=document.body.className+" pixelperfect-wrapper",e.style.overflow="hidden",e.style.position="relative",e.style.margin="0",$("body > *").elements.every(function(t){return e.appendChild(t),!0}),document.body.appendChild(e),this.wrapper=e,o=function(){this.wrapper.style.minHeight=window.innerHeight.toString()+"px"}.bind(this),o(),window.addEventListener("resize",o)},initHTML:function(){var e=document.createElement("div");e.setAttribute("id","pixelperfect"),e.innerHTML=this.HTML,document.body.appendChild(e)},initStyles:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("media","all"),e.setAttribute("href","data:text/css;base64,"+this.STYLES),document.head.appendChild(e)},init:function(){this.setDefaults(),this.initOptions(),this.initWrapper(),this.initHTML(),this.initStyles(),DragAndDrop.init(),DragAndDrop.makeDraggable($("#pixelperfect"),"#pixelperfect-top"),t.init(),this.initFileHandling()}};$=function(t,n,r){return new e(t,n,r)},window.$=$,window.onload=function(){n.init()}})();