(function(){var e=function(e,t,n){var r,i,s,o;if(e.nodeName)return this.elements=[e],this.elements_length=1,this;typeof t=="boolean"&&(n=t,t=undefined),n===undefined&&(n=!0);if(n&&this.elements===null){r=[],t===undefined&&(t=document),i=t.querySelectorAll(e),s=i.length;for(o=0;o<s;o++)r.push(i[o]);this.elements=r,this.elements_length=r.length}return this};e.prototype={elements:null,elements_length:0,event:function(t,n){var r;return this.elements.every(function(r){return r.addEventListener(t,n.bind(new e(r))),!0}),this},remove:function(){return this.elements.every(function(e){return e.parentNode.removeChild(e),!0}),this},removeClass:function(e){return this.elements.every(function(t){return t.className=t.className.replace(RegExp(e,"g"),"").replace(/^\s+|\s+$/,""),!0}.bind(this)),this},addClass:function(e){return this.removeClass(e),this.elements.every(function(t){return t.className+=" "+e,!0}.bind(this)),this}},DragAndDrop={makeDraggable:function(e,t){var n;for(n=0;n<e.elements_length;n++)t===undefined?t=e.elements[n]:(t=e.elements[n].querySelector(t),t||(t=e.elements[n])),t.addEventListener("mousedown",function(e){document.currentDragged=this,document.currentDragged.mouseDiffX=e.pageX-this.offsetLeft,document.currentDragged.mouseDiffY=e.pageY-this.offsetTop}.bind(e.elements[n]))},init:function(){document.addEventListener("mouseup",function(){this.currentDragged=!1}),document.addEventListener("mousemove",function(e){this.currentDragged&&(this.currentDragged.style.right="auto",this.currentDragged.style.bottom="auto",this.currentDragged.style.left=(e.pageX-this.currentDragged.mouseDiffX).toString()+"px",this.currentDragged.style.top=(e.pageY-this.currentDragged.mouseDiffY).toString()+"px")})}};var t={insertLayer:function(e,t){var n=document.createElement("div"),r=document.createElement("a"),i=new Image,s=document.createElement("canvas"),o=s.getContext("2d");n.className="pixelperfect-layer",r.className="pixelperfect-button",r.innerHTML="&#10008;",n.appendChild(i),n.appendChild(r),e.match(/^blob:/)?i.onload=function(){var e,t;e=i.src.replace("blob:",""),t="pixelperfect:"+e,s.width=i.width,s.height=i.height,o.drawImage(i,0,0),localStorage.setItem(t,s.toDataURL("image/jpeg")),n.setAttribute("data-id",t),URL.revokeObjectURL(e),this.appendLayer(n),this.selectLayer(this.fillSelected())}.bind(this):(t!==undefined&&n.setAttribute("data-id",t),this.appendLayer(n),this.selectLayer(this.fillSelected())),i.src=e},appendLayer:function(e){$("#pixelperfect-layers").elements[0].appendChild(e)},selectLayer:function(e){e===undefined&&(e=localStorage.getItem("pixelperfect:selected")),e&&($("#pixelperfect-layers .pixelperfect-layer").removeClass("pixelperfect-layer-selected"),$('#pixelperfect-layers .pixelperfect-layer[data-id="'+e+'"]').addClass("pixelperfect-layer-selected"),localStorage.setItem("pixelperfect:selected",e))},removeLayer:function(e){$('#pixelperfect-layers .pixelperfect-layer[data-id="'+e+'"]').remove(),localStorage.removeItem(e),this.selectLayer(this.fillSelected())},fillSelected:function(){var e,t=localStorage.getItem("pixelperfect:selected");if(!t||!localStorage.getItem(t))for(e in localStorage)if(e.match(/^pixelperfect:[0-9a-f]+/)&&localStorage.hasOwnProperty(e)){t=e;break}return t&&localStorage.setItem("pixelperfect:selected",t),t},refresh:function(){var e;$("#pixelperfect-layers .pixelperfect-layer").remove();for(e in localStorage)e.match(/^pixelperfect:[0-9a-f]+/)&&localStorage.hasOwnProperty(e)&&this.insertLayer(localStorage.getItem(e),e);this.selectLayer(this.fillSelected())},init:function(){this.refresh(),$("#pixelperfect-layers .pixelperfect-layer").event("click",function(e){e.preventDefault(),t.selectLayer(this.elements[0].getAttribute("data-id"))}),$("#pixelperfect-layers .pixelperfect-button").event("click",function(e){e.preventDefault(),e.stopPropagation(),t.removeLayer.call(t,this.elements[0].parentNode.getAttribute("data-id"))})}},n={STYLES:"I3BpeGVscGVyZmVjdHt3aWR0aDoyMDBweDtwYWRkaW5nOjEwcHg7cG9zaXRpb246Zml4ZWQ7cmlnaHQ6MjBweDt0b3A6MjBweDtjdXJzb3I6ZGVmYXVsdDstbW96LWJvcmRlci1yYWRpdXM6OHB4Oy13ZWJraXQtYm9yZGVyLXJhZGl1czo4cHg7LW8tYm9yZGVyLXJhZGl1czo4cHg7LW1zLWJvcmRlci1yYWRpdXM6OHB4O2JvcmRlci1yYWRpdXM6OHB4Oy1tb3otYm94LXNoYWRvdzowIDAgN3B4IHJnYmEoMCwwLDAsMC42KTstd2Via2l0LWJveC1zaGFkb3c6MCAwIDdweCByZ2JhKDAsMCwwLDAuNik7LW8tYm94LXNoYWRvdzowIDAgN3B4IHJnYmEoMCwwLDAsMC42KTstbXMtYm94LXNoYWRvdzowIDAgN3B4IHJnYmEoMCwwLDAsMC42KTtib3gtc2hhZG93OjAgMCA3cHggcmdiYSgwLDAsMCwwLjYpfSNwaXhlbHBlcmZlY3QgKntmb250LWZhbWlseTpBcmlhbCxIZWx2ZXRpY2Esc2Fucy1zZXJpZjtmb250LXNpemU6MTJweDt0ZXh0LWRlY29yYXRpb246bm9uZX0jcGl4ZWxwZXJmZWN0PmRpdntvdmVyZmxvdzpoaWRkZW47aGVpZ2h0OjIwcHg7bGluZS1oZWlnaHQ6MjBweDtwYWRkaW5nOjVweCAwfSNwaXhlbHBlcmZlY3QgLnBpeGVscGVyZmVjdC1sYWJlbHt3aWR0aDo1NXB4O3BhZGRpbmctcmlnaHQ6NXB4O3RleHQtYWxpZ246cmlnaHQ7ZGlzcGxheTpibG9jaztmbG9hdDpsZWZ0O2ZvbnQtd2VpZ2h0OmJvbGR9I3BpeGVscGVyZmVjdCBpbnB1dFt0eXBlPSJ0ZXh0Il17d2lkdGg6MzVweDtoZWlnaHQ6MTRweDtwYWRkaW5nOjJweDtib3JkZXI6MXB4IHNvbGlkICNjMGMwYzA7LW1vei1ib3JkZXItcmFkaXVzOjNweDstd2Via2l0LWJvcmRlci1yYWRpdXM6M3B4Oy1vLWJvcmRlci1yYWRpdXM6M3B4Oy1tcy1ib3JkZXItcmFkaXVzOjNweDtib3JkZXItcmFkaXVzOjNweH0jcGl4ZWxwZXJmZWN0IC5waXhlbHBlcmZlY3QtYnV0dG9ue3dpZHRoOjIwcHg7aGVpZ2h0OjIwcHg7YmFja2dyb3VuZDojYjZiNmI2IHVybChkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EZGhBUUFVQUlRVUFLS2lvcVdscGFlbnA2cXFxcXlzcksrdnI3R3hzYlMwdExhMnRybTV1YnU3dTc2K3ZzREF3TVBEdzhYRnhjakl5TXJLeXMzTnpjL1B6OUxTMHYvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL3l3QUFBQUFBUUFVQUFBRkVlQWtSZERqTk15aUpNaGhGTVFnQkVBSUFEcz0pIHJlcGVhdC14IGNlbnRlciBjZW50ZXI7ZGlzcGxheTpibG9jaztmbG9hdDpyaWdodDttYXJnaW4tbGVmdDo0cHg7Y29sb3I6I2ZmZjt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoyMHB4Oy1tb3otYm9yZGVyLXJhZGl1czo0cHg7LXdlYmtpdC1ib3JkZXItcmFkaXVzOjRweDstby1ib3JkZXItcmFkaXVzOjRweDstbXMtYm9yZGVyLXJhZGl1czo0cHg7Ym9yZGVyLXJhZGl1czo0cHg7Zm9udC1zaXplOjE2cHg7Y3Vyc29yOnBvaW50ZXJ9I3BpeGVscGVyZmVjdCAucGl4ZWxwZXJmZWN0LWJ1dHRvbjpob3ZlcntvcGFjaXR5Oi44fSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC10b3B7bWFyZ2luOi0xMHB4IC0xMHB4IDA7cGFkZGluZzoxMHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNkYWRhZGE7bGluZS1oZWlnaHQ6MjBweDtjdXJzb3I6bW92ZX0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtbGFuZy15e21hcmdpbi1sZWZ0OjEwcHh9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LXZlcnRpY2FsLXRvcHtsaW5lLWhlaWdodDo2cHh9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LXZlcnRpY2FsLWJvdHRvbXtsaW5lLWhlaWdodDozMHB4fSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1ob3Jpem9udGFsLWxlZnR7bWFyZ2luLWxlZnQ6MH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtYWRkbGF5ZXJ7Ym9yZGVyLXRvcDoxcHggc29saWQgI2RhZGFkYTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZGFkYWRhO21hcmdpbjowIC0xMHB4O3BhZGRpbmc6NXB4IDEwcHh9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LWFkZGxheWVyICNwaXhlbHBlcmZlY3QtZmlsZXt3aWR0aDoxMTBweH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtYWRkbGF5ZXIgI3BpeGVscGVyZmVjdC1maWxlaW5wdXR7ZGlzcGxheTpub25lfSNwaXhlbHBlcmZlY3QgI3BpeGVscGVyZmVjdC1sYXllcnN7aGVpZ2h0OmF1dG99I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LWxheWVycyAucGl4ZWxwZXJmZWN0LWxheWVye21heC1oZWlnaHQ6MTIwcHg7cGFkZGluZzo1cHggMzBweCA1cHggNXB4Oy1tb3otYm9yZGVyLXJhZGl1czoxMHB4Oy13ZWJraXQtYm9yZGVyLXJhZGl1czoxMHB4Oy1vLWJvcmRlci1yYWRpdXM6MTBweDstbXMtYm9yZGVyLXJhZGl1czoxMHB4O2JvcmRlci1yYWRpdXM6MTBweDtvdmVyZmxvdzphdXRvO3Bvc2l0aW9uOnJlbGF0aXZlO3RleHQtYWxpZ246Y2VudGVyO2JhY2tncm91bmQ6I2ZmZjttYXJnaW4tYm90dG9tOjVweH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtbGF5ZXJzIC5waXhlbHBlcmZlY3QtbGF5ZXIsI3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LWxheWVycyAucGl4ZWxwZXJmZWN0LWxheWVyIGltZ3ttYXgtd2lkdGg6MTY1cHg7bWF4LWhlaWdodDoxMjBweDt2ZXJ0aWNhbC1hbGlnbjp0b3B9I3BpeGVscGVyZmVjdCAjcGl4ZWxwZXJmZWN0LWxheWVycyAucGl4ZWxwZXJmZWN0LWxheWVyLXNlbGVjdGVke2JhY2tncm91bmQ6I2VkZWZmNH0jcGl4ZWxwZXJmZWN0ICNwaXhlbHBlcmZlY3QtbGF5ZXJzIC5waXhlbHBlcmZlY3QtYnV0dG9ue3Bvc2l0aW9uOmFic29sdXRlO3RvcDo1cHg7cmlnaHQ6NXB4fQ==",layers:[],initFileHandling:function(){$("#pixelperfect-upload-file").event("click",function(e){e.preventDefault(),document.getElementById("pixelperfect-fileinput").click()}),$("#pixelperfect-fileinput").event("change",function(e){t.insertLayer(window.URL.createObjectURL(e.target.files[0]))}.bind(this))},initStyles:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("media","all"),e.setAttribute("href","data:text/css;base64,"+this.STYLES),document.head.appendChild(e)},init:function(){DragAndDrop.init(),t.init(),this.initStyles(),this.initFileHandling()}};$=function(t,n,r){return new e(t,n,r)},window.$=$,window.onload=function(){n.init()}})();